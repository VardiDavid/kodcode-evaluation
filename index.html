<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>טופס הערכת תלמידים - כיתות אלקטרוניקה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Assistant', sans-serif;
        }
        input[type="radio"]:focus + label {
            outline: 2px solid #2563eb;
            outline-offset: 2px;
            border-radius: 9999px;
        }
        .scale-container { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .radio-group { display: flex; justify-content: center; gap: 0.5rem; }
        @media (min-width: 640px) { .radio-group { gap: 1rem; } }
        option.completed { color: #16a34a; font-weight: 600; }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">טופס הערכת תלמידים - כיתות אלקטרוניקה</h1>
            <p class="text-lg text-gray-600 mt-2">מערכת פשוטה ונוחה למילוי הערכות</p>
        </header>

        <!-- Introduction for teachers -->
        <div class="bg-blue-50 border-r-4 border-blue-500 p-4 mb-8 rounded-r-lg shadow-sm">
            <h3 class="font-bold text-blue-800 text-lg">מורים יקרים, שימו לב!</h3>
            <p class="text-gray-700 mt-2">
                למילוי טופס זה חשיבות מכרעת בעתידם של התלמידים. הנתונים שתזינו מהווים גורם משמעותי בשיבוצם ליחידות הטכנולוגיות השונות בצה"ל.
                הערכה כנה ומדויקת תסייע לנו להתאים לכל תלמיד את התפקיד ההולם ביותר את כישוריו, ותפתח בפניו דלתות להזדמנויות משמעותיות בשירות הצבאי ובעתיד.
                <br>תודה על שיתוף הפעולה!
            </p>
        </div>

        <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-gray-200">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div>
                    <label for="class-select" class="block text-lg font-semibold text-gray-700 mb-2">1. בחירת כיתה:</label>
                    <select id="class-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="">-- יש לבחור כיתה --</option>
                    </select>
                </div>
                <div>
                    <label for="student-select" class="block text-lg font-semibold text-gray-700 mb-2">2. בחירת תלמיד/ה:</label>
                    <select id="student-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" disabled>
                        <option value="">-- יש לבחור תלמיד/ה --</option>
                    </select>
                </div>
            </div>

            <form id="evaluation-form" class="hidden">
                <div id="form-title" class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-blue-700"></h2>
                </div>
                <div class="space-y-8"></div>
                <div class="mt-10">
                     <label for="general-notes" class="block text-lg font-semibold text-gray-700 mb-2">הערות כלליות (רשות):</label>
                     <textarea id="general-notes" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="נקודות לחיזוק, התנהגות חריגה, או כל הערה נוספת..."></textarea>
                </div>
                <div class="mt-10 text-center">
                    <button type="submit" id="submit-button" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 transform hover:scale-105 w-40">
                        שלח הערכה
                    </button>
                </div>
            </form>
            
            <div id="success-message" class="hidden text-center p-6 bg-green-100 border-2 border-green-500 rounded-2xl">
                <h2 class="text-2xl font-bold text-green-800">ההערכה נשלחה בהצלחה!</h2>
                <p class="text-gray-700 mt-2">הטופס אופס וכעת ניתן להעריך את התלמיד/ה הבא/ה.</p>
                <button id="reset-button" class="mt-4 bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition">
                    הערכה חדשה
                </button>
            </div>
        </div>
         <footer class="text-center mt-8 text-gray-500">
            <p>&copy; 2024 - נוצר עבור תכנית kodcode</p>
        </footer>
    </div>

    <script>
        // --- הגדרות ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbySFrtoASdVKoKf0klsL-2vbXRtBYQJaoZCvBYomlJ3cZ-HDtfK6KhdkobUQyNrq8v_/exec"; 

        const studentData = {
            "מערכות ספרתיות - פת": [
              { id: "323946467", name: "נחמיה בלויגרונד" },
              { id: "206583890", name: "יצחק בוכריץ" },
              { id: "205967136", name: "דובי תמרי" },
              { id: "314662198", name: "אלחנן חג'בי" },
              { id: "325440170", name: "מנחם דויטש" },
              { id: "325354637", name: "ברוך דניגר" },
              { id: "213843253", name: "אברהם דב שטיין" },
              { id: "206998874", name: "משה בן זקרי" },
              { id: "316207372", name: "יאיר זלוקוביץ" },
              { id: "315310094", name: "אורי אלבז" },
              { id: "326636651", name: "דוד כהן" },
              { id: "325544963", name: "יוסף קנתן" },
              { id: "213144892", name: "נועם אלימלך" },
              { id: "322326679", name: "יהודה לזימי" },
              { id: "211980644", name: "מוישי מנדלסון" },
              { id: "324184530", name: "מיכאל כהן" },
              { id: "207885617", name: "נתן רובינוב" },
              { id: "211838479", name: "אבי גולדברג" },
              { id: "324984939", name: "משה אריה" },
              { id: "325940161", name: "בנימין שדה" },
              { id: "318783933", name: "אביתר שפירא" }
            ],
            "תורת החשמל - פת": [
              { id: "323946467", name: "נחמיה בלויגרונד" },
              { id: "206583890", name: "יצחק בוכריץ" },
              { id: "205967136", name: "דובי תמרי" },
              { id: "314662198", name: "אלחנן חג'בי" },
              { id: "325440170", name: "מנחם דויטש" },
              { id: "325354637", name: "ברוך דניגר" },
              { id: "213843253", name: "אברהם דב שטיין" },
              { id: "206998874", name: "משה בן זקרי" },
              { id: "316207372", name: "יאיר זלוקוביץ" },
              { id: "315310094", name: "אורי אלבז" },
              { id: "326636651", name: "דוד כהן" },
              { id: "325544963", name: "יוסף קנתן" },
              { id: "213144892", name: "נועם אלימלך" },
              { id: "322326679", name: "יהודה לזימי" },
              { id: "211980644", name: "מוישי מנדלסון" },
              { id: "324184530", name: "מיכאל כהן" },
              { id: "207885617", name: "נתן רובינוב" },
              { id: "211838479", name: "אבי גולדברג" },
              { id: "324984939", name: "משה אריה" },
              { id: "325940161", name: "בנימין שדה" },
              { id: "318783933", name: "אביתר שפירא" }
            ],
            "אלקטרוניקה - ים": [
              { id: "326137114", name: "אהרון פרקש" },
              { id: "327339644", name: "איתן אנקין" },
              { id: "209302686", name: "אלי בוקסנבוים" },
              { id: "327138731", name: "אליהו וולף" },
              { id: "324818731", name: "בניהו משה חדד" },
              { id: "325286722", name: "בנימין פדידה" },
              { id: "323078204", name: "דוד אמיתי" },
              { id: "211625694", name: "דוד קוזוין" },
              { id: "212315915", name: "יאיר ששון גרייבי" },
              { id: "325735959", name: "יהונתן מנסורי" },
              { id: "326206679", name: "יוחנן בורנשטיין" },
              { id: "214552408", name: "יעקב מימון אביגל" },
              { id: "214661019", name: "ישראל מאיר גדליה" },
              { id: "208025957", name: "מרדכי אפללו" },
              { id: "325201440", name: "מרדכי חמוי" },
              { id: "314757857", name: "רפאל שניאור" },
              { id: "323812974", name: "שלמה ברוינר" },
              { id: "315700500", name: "שמעון רישי" },
              { id: "315916205", name: "משה בריסקמן" },
              { id: "211737036", name: "משה הרשלר" }
            ]
        };

        const evaluationCriteria = ["רמת מוטיבציה", "עמידה בנהלים", "קבלת סמכות", "הבנת חומר הלימוד", "שואל שאלות הבנה", "נעזר בעמיתים", "פסיבי- מחכה שיידגמו אותו", "יכולת עבודה בצוות", "האם עוזר לחברים", "יכולת למידה עצמית", "סקרנות", "יכולת לקבל ביקורת", "מגדיל ראש", "דירוג ביחס לכיתה"];
        const STATUS_STORAGE_KEY = 'evaluationStatus';

        const classSelect = document.getElementById('class-select');
        const studentSelect = document.getElementById('student-select');
        const evaluationForm = document.getElementById('evaluation-form');
        const formTitle = document.getElementById('form-title').querySelector('h2');
        const formContent = evaluationForm.querySelector('.space-y-8');
        const successMessage = document.getElementById('success-message');
        const resetButton = document.getElementById('reset-button');
        const submitButton = document.getElementById('submit-button');

        const radioBgColors = ['bg-red-500', 'bg-orange-400', 'bg-amber-400', 'bg-yellow-400', 'bg-lime-500', 'bg-green-500'];
        const radioTextColors = ['text-white', 'text-white', 'text-gray-800', 'text-gray-800', 'text-gray-800', 'text-white'];

        function getEvaluationStatus() { const status = localStorage.getItem(STATUS_STORAGE_KEY); return status ? JSON.parse(status) : {}; }
        function saveEvaluationStatus(statusObject) { localStorage.setItem(STATUS_STORAGE_KEY, JSON.stringify(statusObject)); }

        function initializeApp() {
            const classes = Object.keys(studentData).sort();
            classes.forEach(className => { const option = document.createElement('option'); option.value = className; option.textContent = className; classSelect.appendChild(option); });
            
            evaluationCriteria.forEach((criterion, index) => { 
                const criterionId = `criterion-${index}`; 
                const element = document.createElement('div'); 
                element.className = 'bg-gray-100 p-4 rounded-lg border'; 
                let html = `<div class="scale-container"><label class="text-base sm:text-lg font-semibold text-gray-800">${criterion}</label><div class="radio-group" role="radiogroup" aria-labelledby="${criterionId}-label">`; 
                for (let i = 1; i <= 6; i++) { 
                    html += `<div class="flex items-center"><input type="radio" id="${criterionId}-${i}" name="${criterionId}" value="${i}" class="sr-only" required><label for="${criterionId}-${i}" class="cursor-pointer w-8 h-8 sm:w-10 sm:h-10 rounded-full flex items-center justify-center border-2 border-transparent ${radioBgColors[i-1]} ${radioTextColors[i-1]} transition-all font-bold text-lg">${i}</label></div>`; 
                } 
                html += `</div></div><div class="flex justify-between text-xs sm:text-sm text-gray-500 mt-2 px-1"><span>נמוך</span><span>גבוה</span></div>`; 
                element.innerHTML = html; 
                formContent.appendChild(element); 
            });
            
            formContent.addEventListener('change', (e) => { 
                if (e.target.type === 'radio') { 
                    const groupName = e.target.name; 
                    document.querySelectorAll(`input[name="${groupName}"]`).forEach(radio => { 
                        radio.nextElementSibling.classList.remove('ring-4', 'ring-offset-2', 'ring-blue-500'); 
                    }); 
                    e.target.nextElementSibling.classList.add('ring-4', 'ring-offset-2', 'ring-blue-500');
                } 
            });
        }

        function populateStudents() {
            const selectedClass = classSelect.value;
            const currentStudentSelection = studentSelect.value;
            const evaluationStatus = getEvaluationStatus();
            studentSelect.innerHTML = '<option value="">-- יש לבחור תלמיד/ה --</option>';
            evaluationForm.classList.add('hidden');
            if (selectedClass && studentData[selectedClass]) {
                const students = [...studentData[selectedClass]].sort((a, b) => a.name.localeCompare(b.name));
                students.forEach(student => { const option = document.createElement('option'); option.value = student.id; if (evaluationStatus[student.name]) { option.textContent = `✅ ${student.name}`; option.classList.add('completed'); } else { option.textContent = student.name; } studentSelect.appendChild(option); });
                studentSelect.disabled = false;
                if (students.find(s => s.id === currentStudentSelection)) {
                    studentSelect.value = currentStudentSelection;
                }
            } else { studentSelect.disabled = true; }
        }

        function showEvaluationForm() {
            const selectedStudentId = studentSelect.value;
            const selectedClass = classSelect.value;
            if (selectedStudentId && selectedClass) {
                const student = studentData[selectedClass].find(s => s.id === selectedStudentId);
                if (student) {
                    formTitle.textContent = `הערכה עבור: ${student.name}`;
                    evaluationForm.reset();
                    document.querySelectorAll('input[type="radio"]').forEach(radio => { 
                        radio.nextElementSibling.classList.remove('ring-4', 'ring-offset-2', 'ring-blue-500'); 
                    });
                    evaluationForm.classList.remove('hidden');
                    successMessage.classList.add('hidden');
                }
            } else { evaluationForm.classList.add('hidden'); }
        }
        
        function resetFullForm() {
            evaluationForm.reset();
            document.querySelectorAll('input[type="radio"]').forEach(radio => { 
                radio.nextElementSibling.classList.remove('ring-4', 'ring-offset-2', 'ring-blue-500');
            });
            evaluationForm.classList.add('hidden');
            successMessage.classList.add('hidden');
            classSelect.value = "";
            studentSelect.innerHTML = '<option value="">-- יש לבחור תלמיד/ה --</option>';
            studentSelect.disabled = true;
        }

        function handleFormSubmit(event) {
            event.preventDefault();
            if (SCRIPT_URL === "") {
                alert("שגיאה: יש להגדיר את כתובת הסקריפט (SCRIPT_URL) בקוד תחילה.");
                return;
            }

            const selectedClass = classSelect.value;
            const selectedStudentId = studentSelect.value;
            const student = studentData[selectedClass].find(s => s.id === selectedStudentId);

            if (!student) {
                alert("שגיאה: לא נבחר תלמיד.");
                return;
            }

            const evaluationData = { 
                class: selectedClass, 
                studentName: student.name, 
                studentId: student.id,
                evaluationDate: new Date().toISOString(), 
                scores: {}, 
                notes: document.getElementById('general-notes').value 
            };

            const formData = new FormData(event.target);
            for (let [key, value] of formData.entries()) { const criterionIndex = key.split('-')[1]; const criterionName = evaluationCriteria[criterionIndex]; evaluationData.scores[criterionName] = parseInt(value, 10); }
            
            const originalButtonText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 inline-block text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>שולח...`;

            fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(evaluationData) })
                .then(() => {
                    const currentStatus = getEvaluationStatus();
                    currentStatus[student.name] = true;
                    saveEvaluationStatus(currentStatus);
                    evaluationForm.classList.add('hidden');
                    successMessage.classList.remove('hidden');
                    populateStudents();
                })
                .catch(error => {
                    console.error('Error sending data:', error);
                    alert('אירעה שגיאה בשליחת הנתונים. אנא בדוק את חיבור האינטרנט ונסה שוב.');
                })
                .finally(() => {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                });
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
        classSelect.addEventListener('change', populateStudents);
        studentSelect.addEventListener('change', showEvaluationForm);
        evaluationForm.addEventListener('submit', handleFormSubmit);
        resetButton.addEventListener('click', resetFullForm);
    </script>
</body>
</html>

